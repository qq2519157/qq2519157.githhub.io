<!-- build time:Tue Aug 08 2023 14:04:13 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="https://log992.cn/rss.xml"><link rel="alternate" type="application/atom+xml" href="https://log992.cn/atom.xml"><link rel="alternate" type="application/json" href="https://log992.cn/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="NFC"><link rel="canonical" href="https://log992.cn/android/Android%E4%B8%ADNFC%E7%9A%84%E4%BD%BF%E7%94%A8/"><title>Android 中 NFC 的使用 - Android | 空无之境 = = 不忘初心，方得始终</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Android 中 NFC 的使用</h1><div class="meta"><span class="item" title="创建时间：2023-06-01 14:30:55"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-06-01T14:30:55+08:00">2023-06-01</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>6.9k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>6 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">空无之境</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://image.baidu.com/search/down?url=https://tva1.sinaimg.cn/large/6833939bly1giclhpw3lwj20zk0m8gvw.jpg"></li><li class="item" data-background-image="https://image.baidu.com/search/down?url=https://tva1.sinaimg.cn/large/6833939bly1gipet4bz0yj20zk0m8e81.jpg"></li><li class="item" data-background-image="https://image.baidu.com/search/down?url=https://tva1.sinaimg.cn/large/6833939bly1gipetlbztpj20zk0m84qp.jpg"></li><li class="item" data-background-image="https://image.baidu.com/search/down?url=https://tva1.sinaimg.cn/large/6833939bly1gicli9lfebj20zk0m84qp.jpg"></li><li class="item" data-background-image="https://image.baidu.com/search/down?url=https://tva1.sinaimg.cn/large/6833939bly1gicli3sbvtj20zk0m8x6p.jpg"></li><li class="item" data-background-image="https://image.baidu.com/search/down?url=https://tva1.sinaimg.cn/large/6833939bly1gipeun65urj20zk0m81ii.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/android/" itemprop="item" rel="index" title="分类于 Android"><span itemprop="name">Android</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://log992.cn/android/Android%E4%B8%ADNFC%E7%9A%84%E4%BD%BF%E7%94%A8/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Logan"><meta itemprop="description" content="不忘初心，方得始终, 一个简简单单的 Android 开发"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"><blockquote><p>最近需要将先前项目的芯片识别功能优化，先前的项目使用的是 RFID 高频芯片识别 + 二维码扫描处理，后续设备大概率不会上 RFID 设备，因此需要接入 NFC 识别。</p></blockquote><h4 id="什么是nfc"><a class="anchor" href="#什么是nfc">#</a> 什么是 NFC</h4><p>NFC 是近场通信 (Near Field Communication,NFC)，是一种短距高频的无线电技术。</p><p>由非接触式射频识别 (RFID) 演变而来。NFC 工作频率为 13.56Hz，有效范围为 20cm 以内，其传输速度有 106 Kbit / 秒、212 Kbit / 秒或者 424 Kbit / 秒三种。NFC 采用主动和被动两种读取模式。</p><h4 id="如何接入"><a class="anchor" href="#如何接入">#</a> 如何接入</h4><p>Android 系统自带 NFC，在手机存在 NFC 硬件时就可以使用了。早在 Android2.3 时，我们就能使用 Android Beam 在同步的设备间通过 NFC 传递图片等数据。通过查阅源码我们得知，NFC 属于系统服务，在使用时自然是需要通过 <code>context.getSystemService(Context.NFC_SERVICE);</code> 来获取系统服务</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre>     * Use with &#123;@link #getSystemService(String)&#125; to retrieve a</pre></td></tr><tr><td data-num="3"></td><td><pre>     * &#123;@link android.nfc.NfcManager&#125; for using NFC.</pre></td></tr><tr><td data-num="4"></td><td><pre>     *</pre></td></tr><tr><td data-num="5"></td><td><pre>     * @see #getSystemService(String)</pre></td></tr><tr><td data-num="6"></td><td><pre>     */</pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">NFC_SERVICE</span> <span class="token operator">=</span> <span class="token string">"nfc"</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>我们需要构建一个 <code>NfcManager</code> 来使用 NFC，而 <code>NfcManager</code> 中只有一个主角，那就是 <code>NfcAdapter</code> !</p><p>想要获得 <code>NfcAdapter</code> ，只需要使用静态方法</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">NfcAdapter</span><span class="token punctuation">.</span><span class="token function">getDefaultAdapter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>其中的 <code>context</code> 用来启动 NFC 服务，等价于：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">NfcManager</span> manager <span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">NfcManager</span><span class="token punctuation">)</span>context<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">NFC_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">NfcAdapter</span> adapter <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">getDefaultAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>通过 <code>NfcAdapter</code> 的 <code>enableForegroundDispatch()</code> 方法启用对给定 Activity 的前台分发，即最高优先级的分发（优先级这个后面再说）。</p><figure class="highlight tex"><figcaption data-lang="TeX"></figcaption><table><tr><td data-num="1"></td><td><pre>This method must be called from the main thread, and only when the activity is in the foreground (resumed). Also, activities must call disableForegroundDispatch before the completion of their Activity.onPause callback to disable foreground dispatch after it has been enabled.</pre></td></tr></table></figure><p>方法的注释也写的很清楚，必须在主线程调用，同时必须当前 <code>activity</code> 可见 / 在前台，同样的，我们需要在 <code>activity</code> 不可见的时候调用 <code>disableForegroundDispatch()</code> 方法。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token comment">// 设置处理优于所有其他 NFC 的处理</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>mNfcAdapter <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            mNfcAdapter<span class="token punctuation">.</span><span class="token function">enableForegroundDispatch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> mPendingIntent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token comment">// 恢复默认状态</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>mNfcAdapter <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            mNfcAdapter<span class="token punctuation">.</span><span class="token function">disableForegroundDispatch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>那么基本的就是这个成对出现的方法了。</p><p><code>enableForegroundDispatch()</code> 方法中需要一个 <code>PendingIntent</code> ，下面是我们构建的 <code>PendingIntent</code></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 一旦截获 NFC 消息，就会通过 PendingIntent 调用窗口</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        mPendingIntent <span class="token operator">=</span> <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>构建 <code>PendingIntent</code> 时我们传入的 <code>Intent</code> 直接使用了 <code>getClass()</code> ，因此，回调的数据会到当前的 <code>activity</code> 中，我们需要重载 <code>onNewIntent()</code> 方法来处理我们接收到的数据。</p><h4 id="如何读取"><a class="anchor" href="#如何读取">#</a> 如何读取</h4><p>上面说道在 <code>onNewIntent()</code> 方法中就能处理我们收到的 NFC 数据了，这就不得不说另外一个重要的对象 <code>Tag</code> 了</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//1. 获取 Tag 对象</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token class-name">Tag</span> detectedTag <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getParcelableExtra</span><span class="token punctuation">(</span><span class="token class-name">NfcAdapter</span><span class="token punctuation">.</span><span class="token constant">EXTRA_TAG</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>通过 <code>Intent</code> 获取 <code>Tag</code> 对象</p><p><img data-src="https://image.log1992.com/uPic/image-20230601155044920.png" alt=""></p><p>通过注释可知：</p><p>我们可以通过 <code>Tag</code> 的 <code>getId()</code> 方法获取 ID，通过 <code>getTechList()</code> 方法获取其技术集，技术集代表了当前这个芯片支持的技术，通俗点就是可以支持的格式，或者说是实现某些高级功能的基础支撑。</p><p>每次发现标记 (进入范围) 时都会创建一个新的标记对象，当发现一个标记时，将创建一个 tag 对象，并通过 NfcAdapter 传递给 <code>activity</code> 。没错，就是 <code>PendingIntent</code> 申明的那个。</p><p>接下来 <code>Tag</code> 会经过四个阶段的分发:</p><ol><li><p>前台活动 <code>activity</code> 分发</p><p>调用了 <code>NfcAdapter.enableForegroundDispatch()</code> 方法的 <code>activity</code> ，这个会被优先触发，比如我们平时打开系统 NFC，贴上 NFC 卡片后，系统会提示 “检测到 NFC 卡片”，然后会给我们一些推荐的操作，诸如打开微信，支付宝充值公交卡等等。但是当我们在调用了 <code>NfcAdapter.enableForegroundDispatch()</code> 方法的 <code>activity</code> 可见时，系统的处理就会因为优先级不够而不被触发，转而在当前 <code>activity</code> 回调数据</p></li><li><p>NDEF 数据分发<br>如果标签中包含 NDEF 数据，系统会在第一个 NdefMessage 中检查第一个 NdefRecord，</p></li></ol><p>NdefRecord 可以有很多种类型，其构造方法如下</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">NdefRecord</span><span class="token punctuation">(</span><span class="token keyword">short</span> tnf<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> type<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> id<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> payload<span class="token punctuation">)</span></pre></td></tr></table></figure><p>具体参数说明可以查看源码。</p><p>我们可以在这个地方构建 Android Application Record，</p><p>通过 <code>createApplicationRecord()</code> 方法，例如：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">NdefMessage</span> ndefMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NdefMessage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NdefRecord</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">NdefRecord</span></pre></td></tr><tr><td data-num="2"></td><td><pre>                <span class="token punctuation">.</span><span class="token function">createApplicationRecord</span><span class="token punctuation">(</span><span class="token string">"com.android.mms"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>我们将这样的 NdefRecord 写入标签后，下次我们识别标签就会自动打开短信应用。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">NdefMessage</span> ndefMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NdefMessage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NdefRecord</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token function">createUriRecord</span><span class="token punctuation">(</span><span class="token string">"http://www.baidu.com"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>或者</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">NdefMessage</span> ndefMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NdefMessage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NdefRecord</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">NdefRecord</span><span class="token punctuation">.</span><span class="token function">createUri</span><span class="token punctuation">(</span><span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"http://www.baidu.com"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>构建 Uri 的 Record，我们可以打开网页。</p><p>当然，我们也可以直接写入文本数据</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">NdefMessage</span> ndefMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NdefMessage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NdefRecord</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token function">createTextRecord</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="3"><li><p>标签技术分发</p><p>当 <code>activity</code> 注册时，添加了相应的 <code>intent-filter</code> ，例如：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.nfc.TechFilter<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>NFC/TechFilter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>      <span class="token comment">&lt;!-- Add a technology filter --></span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.nfc.action.TECH_DISCOVERED<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre> </pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta-data</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.nfc.action.TECH_DISCOVERED<span class="token punctuation">"</span></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>          <span class="token attr-name"><span class="token namespace">android:</span>resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@xml/filter_nfc<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token punctuation">/></span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xliff</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>urn:oasis:names:tc:xliff:document:1.2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>      <span class="token comment">&lt;!-- capture anything using NfcF --></span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tech-list</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tech</span><span class="token punctuation">></span></span>android.nfc.tech.NfcF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tech</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tech-list</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre> </pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token comment">&lt;!-- OR --></span></pre></td></tr><tr><td data-num="8"></td><td><pre> </pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token comment">&lt;!-- capture all MIFARE Classics with NDEF payloads --></span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tech-list</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tech</span><span class="token punctuation">></span></span>android.nfc.tech.NfcA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tech</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tech</span><span class="token punctuation">></span></span>android.nfc.tech.MifareClassic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tech</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tech</span><span class="token punctuation">></span></span>android.nfc.tech.Ndef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tech</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tech-list</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>在 <code>intent-filter</code> 中添加对应的 <code>action</code> 后，我们就能通过 <code>action</code> 获取数据了</p></li><li><p>备用分发</p><p>如果所有的分发条件都不满足，就会走 <code>NfcAdapter.ACTION_TAG_DISCOVERED</code> 的 <code>action</code> 来分发数据</p></li></ol><p>读取数据我们可以根据当前的 <code>techType</code> 来读取，例如：</p><p><img data-src="https://image.log1992.com/uPic/image-20230601171030647.png" alt=""></p><p>当前芯片的 <code>TechList</code> 中有 3 条数据，分别是 NFCA，MifareUltralight 和 NEDF，因此我们就能针对性的取数据了。</p><p>NEDF 通过 <code>Ndef ndef = Ndef.get(detectedTag);</code> 来获取 NEDF 实例；</p><p>MifareUltralight 通过 <code>MifareUltralight ultralight = MifareUltralight.get(tag);</code> 来获取 MifareUltralight 实例；</p><p>...</p><p>以此类推</p><p>拿到相应的实例对象后，先判断是否为空，因为数据写入的格式会决定数据写入成哪种 <code>TechType</code> 的数据，后面取值就简单了，拿到对应的 <code>NdefRecord</code> 解析就行了.</p><p>读取 NDEF：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">readNdefTag</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">NfcAdapter</span><span class="token punctuation">.</span><span class="token constant">ACTION_NDEF_DISCOVERED</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>            <span class="token class-name">Parcelable</span><span class="token punctuation">[</span><span class="token punctuation">]</span> rawMsgs <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getParcelableArrayExtra</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                    <span class="token class-name">NfcAdapter</span><span class="token punctuation">.</span><span class="token constant">EXTRA_NDEF_MESSAGES</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token class-name">NdefMessage</span> msgs<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">int</span> contentSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>rawMsgs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                msgs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NdefMessage</span><span class="token punctuation">[</span>rawMsgs<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rawMsgs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                    msgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">NdefMessage</span><span class="token punctuation">)</span> rawMsgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                    contentSize <span class="token operator">+=</span> msgs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token keyword">if</span> <span class="token punctuation">(</span>msgs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                    <span class="token class-name">NdefRecord</span> record <span class="token operator">=</span> msgs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getRecords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                    <span class="token class-name">String</span> textRecord <span class="token operator">=</span> <span class="token class-name">NFCUtils</span><span class="token punctuation">.</span><span class="token function">parseTextRecord</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                    <span class="token keyword">return</span> textRecord<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>读取 MifareUltralight：</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">readTag</span><span class="token punctuation">(</span><span class="token class-name">Tag</span> tag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token class-name">MifareUltralight</span> ultralight <span class="token operator">=</span> <span class="token class-name">MifareUltralight</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            ultralight<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token comment">// 从第 4 索引开始读，前 4 索引对应的为标签固化区</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> ultralight<span class="token punctuation">.</span><span class="token function">readPages</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"GB2312"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                ultralight<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>MifareUltralight 读取涉及到 NFC 标签的分区，前 4 个分区 (索引 0-3) 为固有分区，后面的为数据区，我们要读，要写都要写到数据区中，并且在写的时候需要注意长度。</p><h4 id="如何写入"><a class="anchor" href="#如何写入">#</a> 如何写入</h4><p>下面是 MifareUltralight 写入的方法</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeTag</span><span class="token punctuation">(</span><span class="token class-name">Tag</span> tag<span class="token punctuation">,</span><span class="token class-name">String</span> data<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token comment">// 向 nfc 标签写数据第 1 步，从标签中得到 MifareUltralight</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token class-name">MifareUltralight</span> ultralight <span class="token operator">=</span> <span class="token class-name">MifareUltralight</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token comment">// 向 nfc 标签写数据第 2 步，connect</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            ultralight<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token comment">/**</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            * 向 nfc 标签写数据第 3 步，正式写数据。前 4 页（0 至 3）存储了 NFC 标签相关的信息</pre></td></tr><tr><td data-num="12"></td><td><pre>            * 注意 Charset.forName ("GB2312")),</pre></td></tr><tr><td data-num="13"></td><td><pre>            * 不用 utf-8 因为一个汉字有可能用 3 个字节编码汉字，那么 2 个汉字有可能是 6 个字节.</pre></td></tr><tr><td data-num="14"></td><td><pre>            * 而 GB2312 始终用 2 个字节。而每页最多 4 个字节，</pre></td></tr><tr><td data-num="15"></td><td><pre>            */</pre></td></tr><tr><td data-num="16"></td><td><pre>            ultralight<span class="token punctuation">.</span><span class="token function">writePage</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"GB2312"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 第 4 页，页从 0 开始.</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            ultralight<span class="token punctuation">.</span><span class="token function">writePage</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"GB2312"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token class-name">ToastUtils</span><span class="token punctuation">.</span><span class="token function">showShort</span><span class="token punctuation">(</span> <span class="token string">"成功写入MifareUltralight格式数据"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                ultralight<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>汉字的编码长度在不同的编码下会有不同的占位。</p><p>M1 卡有从 0 到 15 共 16 个扇区，每个扇区配备了从 0 到 3 共 4 个段，每个段可以保存 16 字节的内容，我们一般可以存 1024 字节的数据，根据我们写入的数据长度，要确认下面的数据要写到哪个扇区里，还是比较麻烦的，另外，MifareUltralight 读取时会把后面扇区的空数据也读出来，生成乱码，所以不太推荐使用 MifareUltralight 读取。</p><p>写入 NDEF 数据就比较方便了</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 首先构建 NdefMessage 对象</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">NdefMessage</span> ndefMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NdefMessage</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                <span class="token keyword">new</span> <span class="token class-name">NdefRecord</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token function">createTextRecord</span><span class="token punctuation">(</span>mText<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">writeTag</span><span class="token punctuation">(</span><span class="token class-name">NdefMessage</span> ndefMessage<span class="token punctuation">,</span> <span class="token class-name">Tag</span> tag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token class-name">Ndef</span> ndef <span class="token operator">=</span> <span class="token class-name">Ndef</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>tag<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            ndef<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            ndef<span class="token punctuation">.</span><span class="token function">writeNdefMessage</span><span class="token punctuation">(</span>ndefMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>直接拿到 <code>Ndef</code> 对象调用 <code>writeNdefMessage()</code> 就可以了。</p><div class="tags"><a href="/tags/NFC/" rel="tag"><i class="ic i-tag"></i> NFC</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-06-01 17:34:02" itemprop="dateModified" datetime="2023-06-01T17:34:02+08:00">2023-06-01</time> </span><span id="android/Android中NFC的使用/" class="item leancloud_visitors" data-flag-title="Android 中 NFC 的使用" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechat.png" alt="Logan 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Logan 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Logan 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Logan <i class="ic i-at"><em>@</em></i></li><li class="link"><strong>本文链接：</strong> <a href="https://log992.cn/android/Android%E4%B8%ADNFC%E7%9A%84%E4%BD%BF%E7%94%A8/" title="Android 中 NFC 的使用">https://log992.cn/android/Android中NFC的使用/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/android/%E5%8F%A6%E8%BE%9F%E8%B9%8A%E5%BE%84%E5%B1%8F%E8%94%BD%E6%88%AA%E5%9B%BE%E9%99%90%E5%88%B6/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;image.baidu.com&#x2F;search&#x2F;down?url&#x3D;https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giciryrr3rj20zk0m8nhk.jpg" title="另辟蹊径屏蔽截图限制"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Android</span><h3>另辟蹊径屏蔽截图限制</h3></a></div><div class="item right"><a href="/play/Docker%E6%8B%89%E5%8F%96%E6%8C%87%E5%AE%9A%E6%9E%B6%E6%9E%84%E9%95%9C%E5%83%8F/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;image.baidu.com&#x2F;search&#x2F;down?url&#x3D;https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giph4wqtg4j20zk0m8x6p.jpg" title="Docker拉取指定架构镜像"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> play</span><h3>Docker拉取指定架构镜像</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFnfc"><span class="toc-number">1.</span> <span class="toc-text">什么是 NFC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%8E%A5%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text">如何接入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%AF%BB%E5%8F%96"><span class="toc-number">3.</span> <span class="toc-text">如何读取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%86%99%E5%85%A5"><span class="toc-number">4.</span> <span class="toc-text">如何写入</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/android/%E4%BD%BF%E7%94%A8Fresco%E7%9A%84%E5%9B%BE%E7%89%87ScaleType%E9%97%AE%E9%A2%98/" rel="bookmark" title="使用Fresco的图片ScaleType问题">使用Fresco的图片ScaleType问题</a></li><li><a href="/android/Android%E5%90%8C%E6%AD%A5%E6%9C%AC%E5%9C%B0%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF(token)%E5%88%B0webview/" rel="bookmark" title="Android同步本地登录信息(token)到webview">Android同步本地登录信息(token)到webview</a></li><li><a href="/android/Android%E7%9B%B8%E6%9C%BA%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98/" rel="bookmark" title="Android相机使用问题">Android相机使用问题</a></li><li><a href="/android/Dagger2%E5%9F%BA%E6%9C%AC%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E6%80%BB%E7%BB%93/" rel="bookmark" title="Dagger2基本源码分析总结">Dagger2基本源码分析总结</a></li><li><a href="/android/AndroidStudio3.0+,%E6%96%B0%E7%9A%84%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB,%E4%B8%8D%E8%A6%81%E5%BC%84%E9%94%99!!!/" rel="bookmark" title="Android studio3.0+,新的依赖关系,不要弄错!!!">Android studio3.0+,新的依赖关系,不要弄错!!!</a></li><li><a href="/android/APP%E5%8A%A8%E6%80%81%E5%88%87%E6%8D%A2%E5%AD%97%E4%BD%93%E7%9A%84%E5%AE%9E%E7%8E%B0/" rel="bookmark" title="APP动态切换字体的实现">APP动态切换字体的实现</a></li><li><a href="/android/Android%E5%B9%B3%E6%9D%BF%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5Mac/" rel="bookmark" title="Android平板无法连接Mac">Android平板无法连接Mac</a></li><li><a href="/android/AndroidStudio%20Aapt2%E7%9A%84%E9%97%AE%E9%A2%98/" rel="bookmark" title="Android studio Aapt2的问题">Android studio Aapt2的问题</a></li><li><a href="/android/Android%20studio%20%E6%89%8B%E5%8A%A8%E4%B8%8B%E8%BD%BDfirebase%20service/" rel="bookmark" title="Android studio 手动下载firebase service">Android studio 手动下载firebase service</a></li><li><a href="/android/Android%20studio%204.0%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/" rel="bookmark" title="Android studio 4.0那些事儿">Android studio 4.0那些事儿</a></li><li><a href="/android/Android%E5%A4%9A%E6%B8%A0%E9%81%93%E4%B9%8B%E8%87%AA%E5%AE%9A%E4%B9%89apk%E8%BE%93%E5%87%BA/" rel="bookmark" title="Android多渠道之自定义apk输出">Android多渠道之自定义apk输出</a></li><li><a href="/android/Edittext%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/" rel="bookmark" title="Edittext常用操作">Edittext常用操作</a></li><li><a href="/android/Android%E6%8E%A5%E5%85%A5HTTPS/" rel="bookmark" title="Android接入HTTPS">Android接入HTTPS</a></li><li><a href="/android/%E6%9F%A5%E8%AF%A2Android%E7%9A%84CPU%E6%9E%B6%E6%9E%84/" rel="bookmark" title="查询Android的CPU架构">查询Android的CPU架构</a></li><li><a href="/android/AndroidX%E4%BA%86%E8%A7%A3%E4%B8%80%E4%B8%8B/" rel="bookmark" title="AndroidX了解一下">AndroidX了解一下</a></li><li><a href="/android/%E4%B8%80%E4%B8%AAAPP%E5%A6%82%E4%BD%95%E6%98%BE%E7%A4%BA%E5%A4%9A%E4%B8%AA%E5%90%8E%E5%8F%B0%E4%BB%BB%E5%8A%A1/" rel="bookmark" title="一个APP如何显示多个后台任务">一个APP如何显示多个后台任务</a></li><li><a href="/android/%E4%BD%BF%E7%94%A8registerForActivityResult%E6%9B%BF%E6%8D%A2onActivityResult/" rel="bookmark" title="使用registerForActivityResult替换onActivityResult">使用registerForActivityResult替换onActivityResult</a></li><li><a href="/android/%E8%8E%AB%E5%90%8D%E5%85%B6%E5%A6%99%E7%9A%84TransactionTooLargeException/" rel="bookmark" title="莫名其妙的TransactionTooLargeException">莫名其妙的TransactionTooLargeException</a></li><li><a href="/android/SDK%E5%8D%87%E7%BA%A728%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/" rel="bookmark" title="SDK升级28的那些事儿">SDK升级28的那些事儿</a></li><li><a href="/android/ContextCompat%E5%92%8CResourcesCompat%E7%9A%84%E5%8C%BA%E5%88%AB/" rel="bookmark" title="ContextCompat和ResourcesCompat的区别">ContextCompat和ResourcesCompat的区别</a></li><li><a href="/android/%E5%BD%93%E5%89%8DAPP%E8%B7%B3%E8%BD%AC%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%94%E7%94%A8/" rel="bookmark" title="当前APP跳转第三方应用">当前APP跳转第三方应用</a></li><li><a href="/android/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%A7%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E8%80%97%E6%97%B6%E5%88%86%E6%9E%90/" rel="bookmark" title="数据库大批量操作数据耗时分析">数据库大批量操作数据耗时分析</a></li><li><a href="/android/%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8FIleProvider/" rel="bookmark" title="正确使用FIleProvider">正确使用FIleProvider</a></li><li><a href="/android/Android%E7%AD%BE%E5%90%8D%E8%AF%81%E4%B9%A6%E8%BD%AC%E6%8D%A2/" rel="bookmark" title="Android签名证书转换">Android签名证书转换</a></li><li><a href="/android/APK%E6%89%8B%E5%8A%A8%E7%AD%BE%E5%90%8D/" rel="bookmark" title="APK手动签名">APK手动签名</a></li><li><a href="/android/ADB%E5%91%BD%E4%BB%A4%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/" rel="bookmark" title="ADB命令简单使用">ADB命令简单使用</a></li><li><a href="/android/Bitmap%E6%93%8D%E4%BD%9C%E5%83%8F%E7%B4%A0/" rel="bookmark" title="Bitmap操作像素">Bitmap操作像素</a></li><li><a href="/android/%E6%82%AC%E6%B5%AE%E7%AA%97%E6%9D%83%E9%99%90%E8%8E%B7%E5%8F%96/" rel="bookmark" title="悬浮窗权限获取">悬浮窗权限获取</a></li><li><a href="/android/%E6%97%A0%E6%84%9F%E9%87%8D%E8%BD%BDActivity/" rel="bookmark" title="无感重载Activity">无感重载Activity</a></li><li><a href="/android/%E5%8F%A6%E8%BE%9F%E8%B9%8A%E5%BE%84%E5%B1%8F%E8%94%BD%E6%88%AA%E5%9B%BE%E9%99%90%E5%88%B6/" rel="bookmark" title="另辟蹊径屏蔽截图限制">另辟蹊径屏蔽截图限制</a></li><li class="active"><a href="/android/Android%E4%B8%ADNFC%E7%9A%84%E4%BD%BF%E7%94%A8/" rel="bookmark" title="Android中NFC的使用">Android中NFC的使用</a></li><li><a href="/android/Android%E7%95%8C%E9%9D%A2%E7%81%B0%E5%8C%96%E5%A4%84%E7%90%86/" rel="bookmark" title="Android 界面灰化处理">Android 界面灰化处理</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Logan" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Logan</p><div class="description" itemprop="description">一个简简单单的 Android 开发</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">52</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">8</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">56</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3FxMjUxOTE1Nw==" title="https:&#x2F;&#x2F;github.com&#x2F;qq2519157"><i class="ic i-github"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/android/%E5%8F%A6%E8%BE%9F%E8%B9%8A%E5%BE%84%E5%B1%8F%E8%94%BD%E6%88%AA%E5%9B%BE%E9%99%90%E5%88%B6/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/play/Docker%E6%8B%89%E5%8F%96%E6%8C%87%E5%AE%9A%E6%9E%B6%E6%9E%84%E9%95%9C%E5%83%8F/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/develop/" title="分类于 开发">开发</a></div><span><a href="/develop/mac%E4%B8%8BSVN%E7%9A%84%E8%AE%BE%E7%BD%AE/" title="mac下SVN的设置">mac下SVN的设置</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/android/" title="分类于 Android">Android</a></div><span><a href="/android/%E8%8E%AB%E5%90%8D%E5%85%B6%E5%A6%99%E7%9A%84TransactionTooLargeException/" title="莫名其妙的TransactionTooLargeException">莫名其妙的TransactionTooLargeException</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/develop/" title="分类于 开发">开发</a></div><span><a href="/develop/APP%E5%BC%B1%E7%BD%91%E6%B5%8B%E8%AF%95%E4%B9%8BCharles/" title="APP弱网测试之Charles">APP弱网测试之Charles</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/android/" title="分类于 Android">Android</a></div><span><a href="/android/%E6%AD%A3%E7%A1%AE%E4%BD%BF%E7%94%A8FIleProvider/" title="正确使用FIleProvider">正确使用FIleProvider</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/android/" title="分类于 Android">Android</a></div><span><a href="/android/Android%E7%9B%B8%E6%9C%BA%E4%BD%BF%E7%94%A8%E9%97%AE%E9%A2%98/" title="Android相机使用问题">Android相机使用问题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/android/" title="分类于 Android">Android</a></div><span><a href="/android/Android%E5%90%8C%E6%AD%A5%E6%9C%AC%E5%9C%B0%E7%99%BB%E5%BD%95%E4%BF%A1%E6%81%AF(token)%E5%88%B0webview/" title="Android同步本地登录信息(token)到webview">Android同步本地登录信息(token)到webview</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/android/" title="分类于 Android">Android</a></div><span><a href="/android/Android%E5%B9%B3%E6%9D%BF%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5Mac/" title="Android平板无法连接Mac">Android平板无法连接Mac</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/android/" title="分类于 Android">Android</a></div><span><a href="/android/%E6%9F%A5%E8%AF%A2Android%E7%9A%84CPU%E6%9E%B6%E6%9E%84/" title="查询Android的CPU架构">查询Android的CPU架构</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/develop/" title="分类于 开发">开发</a></div><span><a href="/develop/Json%E6%95%B0%E6%8D%AE%E8%BF%87%E5%A4%A7,%E6%89%8B%E6%9C%BA%E6%97%A0%E6%B3%95%E6%AD%A3%E5%B8%B8%E8%A7%A3%E6%9E%90?/" title="Json数据过大,手机无法正常解析?">Json数据过大,手机无法正常解析?</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/play/" title="分类于 折腾">折腾</a></div><span><a href="/play/Shoka%E4%B8%BB%E9%A2%98%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/" title="Shoka主题基本操作">Shoka主题基本操作</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Logan @ 空无之境</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">111k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">1:41</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"android/Android中NFC的使用/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//fastly.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->